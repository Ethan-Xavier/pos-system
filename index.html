<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>POS — Input & Table Structure (Demo)</title>
  <style>
    body { font-family: system-ui, -apple-system, Arial; padding: 24px; max-width:800px; margin:0 auto; }
    label{display:block;margin-top:10px;font-weight:600}
    input, select, button { padding:8px; font-size:14px; width:100%; box-sizing:border-box }
    .row{display:flex;gap:8px}
    .row > *{flex:1}
    .card{border:1px solid #eee;padding:12px;border-radius:8px;margin-top:12px}
    pre{background:#f7f7f7;padding:12px;border-radius:6px;overflow:auto}
    .table-box{border:1px solid #aaa;border-radius:8px;padding:12px;margin-bottom:12px;background:#fdfdfd;position:relative}
    .table-title{font-weight:700;font-size:16px;margin-bottom:6px;color:#333;display:flex;align-items:center;}
    .order-tag-box{border:1px solid #bbb;border-radius:6px;padding:6px;margin:6px 0;background:#eef;display:flex;flex-direction:column;}
    .order-box{border:1px solid #ccc;border-radius:6px;padding:6px;margin:4px 0;background:#f7f7ff}
    .edit-btn{border:none;background:none;cursor:pointer;font-size:1em; transform: rotate(-20deg); padding:0; margin:0; line-height:1;}
    .tag-header{display:flex;align-items:center;}
    .order-total{margin-top:4px;font-weight:600;text-align:right;}
  </style>
</head>
<body>
  <h2>POS — Input (Demo)</h2>

  <div class="card">
    <label for="tableDesc">Table Description (required)</label>
    <input id="tableDesc" placeholder="Table 1 / John - Table / Window seat" required />

    <label for="orderTag">Order Tag</label>
    <input id="orderTag" placeholder="Single Order" value="Single Order" />

    <div class="row">
      <div>
        <label for="section">Section</label>
        <select id="section">
          <option value="Food">Food</option>
          <option value="Drinks">Drinks</option>
        </select>
      </div>

      <div>
        <label for="item">Item</label>
        <select id="item"></select>
      </div>

      <div style="max-width:110px">
        <label for="qty">Qty</label>
        <input id="qty" type="number" min="1" value="1" />
      </div>
    </div>

    <button id="placeOrderBtn">Place order</button>
  </div>

  <div class="card">
    <h3>posData (current snapshot)</h3>
    <pre id="snapshot">(no orders yet)</pre>
    <p style="font-size:13px;color:#666">Snapshot of posData object</p>
  </div>

  <div class="card">
    <h3>Tables & Orders</h3>
    <div id="tables"></div>
  </div>

  <script>
    const MENU = { 
      Food: [{name:"Burger", price:5}, {name:"Pizza", price:8}, {name:"Salad", price:4}, {name:"Pasta", price:7}],
      Drinks: [{name:"Water", price:1}, {name:"Soda", price:2}, {name:"Coffee", price:3}, {name:"Juice", price:3}]
    };

    const posData = { openOrders: [], closedOrders: [], problemOrders: [] };
    const $ = id => document.getElementById(id);
    const snapshotEl = $('snapshot');

    function populateItems(section){
      const itemSelect = $('item');
      itemSelect.innerHTML = '';
      MENU[section].forEach(it => { const opt = document.createElement('option'); opt.value = it.name; opt.textContent = `${it.name} ($${it.price})`; itemSelect.appendChild(opt); });
    }

    function getItemPrice(section, itemName){
      const found = MENU[section].find(i => i.name === itemName);
      return found ? found.price : 0;
    }

    function uid(prefix = ''){ return prefix + Date.now().toString(36) + Math.random().toString(36).slice(2,7); }

    function updateSnapshot(){ snapshotEl.textContent = JSON.stringify(posData, null, 2); }

    function findTable(tableDescription){ return posData.openOrders.find(t => t.tableDescription === tableDescription); }

    function placeOrder({tableDescription, orderTag, section, item, qty}){
      const timestamp = new Date().toISOString();
      let table = findTable(tableDescription);
      if(!table){ table = { tableId: uid('TBL-'), tableDescription, status: 'occupied', createdAt: timestamp, orders: [] }; posData.openOrders.push(table); }

      let tagOrder = table.orders.find(o => o.orderTag === orderTag);
      if(!tagOrder){ tagOrder = { orderTag: orderTag || 'Single Order', items: [] }; table.orders.push(tagOrder); }

      const existingItem = tagOrder.items.find(i => i.item === item);
      if(existingItem){ existingItem.qty += Number(qty) || 1; }
      else{ tagOrder.items.push({ item, qty: Number(qty) || 1, price: getItemPrice(section, item), timestampCreated: timestamp, orderStatus: 'open' }); }

      updateSnapshot(); renderTables();
    }

    function renderTables(){
      const container = document.getElementById('tables');
      container.innerHTML = '';
      posData.openOrders.forEach(table => {
        const tableDiv = document.createElement('div');
        tableDiv.className = 'table-box';

        const tableTitleDiv = document.createElement('div');
        tableTitleDiv.className = 'table-title';

        const editBtnTable = document.createElement('button');
        editBtnTable.className = 'edit-btn';
        editBtnTable.innerHTML = '✏';
        editBtnTable.onclick = () => {
          const newText = prompt('Edit Table Description', table.tableDescription);
          if(newText) { table.tableDescription = newText; updateSnapshot(); renderTables(); }
        };
        tableTitleDiv.appendChild(editBtnTable);

        const tableText = document.createElement('span');
        tableText.textContent = table.tableDescription;
        tableTitleDiv.appendChild(tableText);
        tableDiv.appendChild(tableTitleDiv);

        table.orders.forEach(tag => {
          const tagDiv = document.createElement('div');
          tagDiv.className = 'order-tag-box';

          const tagHeader = document.createElement('div');
          tagHeader.className = 'tag-header';

          const editBtnTag = document.createElement('button');
          editBtnTag.className = 'edit-btn';
          editBtnTag.innerHTML = '✏';
          editBtnTag.onclick = () => {
            const newText = prompt('Edit Order Tag', tag.orderTag);
            if(newText){ tag.orderTag = newText; updateSnapshot(); renderTables(); }
          };
          tagHeader.appendChild(editBtnTag);

          const tagText = document.createElement('span');
          tagText.style.fontWeight = '600';
          tagText.textContent = tag.orderTag;
          tagHeader.appendChild(tagText);

          tagDiv.appendChild(tagHeader);

          tag.items.forEach(o => {
            const orderDiv = document.createElement('div');
            orderDiv.className = 'order-box';
            orderDiv.textContent = `${o.item} x ${o.qty} - $${o.price}`;
            tagDiv.appendChild(orderDiv);
          });

          const totalDiv = document.createElement('div');
          totalDiv.className = 'order-total';
          const total = tag.items.reduce((sum, i) => sum + i.qty * i.price, 0);
          totalDiv.textContent = `Total: $${total}`;
          tagDiv.appendChild(totalDiv);

          tableDiv.appendChild(tagDiv);
        });

        container.appendChild(tableDiv);
      });
    }

    $('section').addEventListener('change', e => populateItems(e.target.value));
    populateItems($('section').value);

    $('placeOrderBtn').addEventListener('click', () => {
      const tableDescription = $('tableDesc').value.trim();
      if(!tableDescription){ alert('Table Description is required.'); return; }
      const payload = { tableDescription, orderTag: $('orderTag').value.trim() || 'Single Order', section: $('section').value, item: $('item').value, qty: $('qty').value };
      placeOrder(payload);
      $('orderTag').value = 'Single Order'; $('qty').value = 1;
    });

    updateSnapshot(); renderTables();
  </script>
</body>
</html>
